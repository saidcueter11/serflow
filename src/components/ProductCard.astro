---
import type { ImageMetadata } from 'astro'
import type { Categories } from '../mocks/mockProducts'
import { Image } from 'astro:assets'

interface Props {
  id: number
  images: ImageMetadata[]
  mainImage: ImageMetadata
  category: Categories
}

const { id, images, mainImage, category } = Astro.props
---

<div class="flex flex-col gap-3 prose prose-img:m-0 prose-p:m-0 prose-invert">
  <div class="flex flex-col gap-2">
    <a
      href={`/products/${category}/${id}`}
      data-astro-prefetch
      class="group block transition-transform duration-300"
    >
      <div class="overflow-hidden rounded-lg">
        <Image
          src={mainImage}
          alt={category}
          class="w-full h-full object-cover rounded-lg object-center transition-transform duration-300 group-hover:scale-110 group-hover:rotate-2"
          loading="lazy"
          transition:name={`product-image-${id}`}
        />
      </div>
    </a>

    <!-- Stacked preview thumbnails -->
    <div class="flex items-center">
      {
        images.slice(0, 5).map((img, index) => (
          <div
            class="size-8 rounded-full overflow-hidden border border-slate-700 shadow-sm transition-transform duration-200"
            style={`margin-left: ${index === 0 ? '0' : '-0.75rem'}; z-index: ${images.length - index};`}
          >
            <Image
              src={img}
              alt={`${category} preview ${index + 1}`}
              class="w-full h-full object-cover object-center"
              loading="lazy"
            />
          </div>
        ))
      }

      {
        images.length > 3 && (
          <span class="text-xs text-secondary ml-2 self-center">
            +{images.length - 3}
          </span>
        )
      }
    </div>
  </div>
</div>
