---
import type { ImageMetadata } from 'astro'
import type { Categories } from '../mocks/mockProducts'
import { Image } from 'astro:assets'

interface Props {
  id: number
  images: ImageMetadata[]
  mainImage: ImageMetadata
  category: Categories
}

const { id, images, mainImage, category } = Astro.props
---

<div class="flex-col flex gap-3 prose prose-img:m-0 prose-p:m-0 prose-invert">
  <div class="flex flex-col gap-2">
    <a
      href={`/products/${category}/${id}`}
      data-astro-prefetch
      class="hover:scale-110 hover:rotate-2 transform transition-all hover:drop-shadow-xl hover:drop-shadow-primary hover:z-50"
    >
      <Image
        src={mainImage}
        alt={category}
        class="w-full h-72 rounded-lg object-cover object-center aspect-square transition-all duration-300"
        loading="lazy"
        transition:name={`product-image-${id}`}
      />
    </a>

    <!-- Stacked preview thumbnails -->
    <div class="flex items-center">
      {
        images.slice(0, 5).map((img, index) => (
          <div
            class="size-8 rounded-full overflow-hidden border border-slate-700 shadow-sm transition-transform duration-200"
            style={`margin-left: ${index === 0 ? '0' : '-0.75rem'}; z-index: ${images.length - index};`}
          >
            <img
              src={img.src}
              alt={`${category} preview ${index + 1}`}
              class="w-full h-full object-cover object-center"
              loading="lazy"
            />
          </div>
        ))
      }

      {
        images.length > 3 && (
          <span class="text-xs text-secondary ml-2 self-center">
            +{images.length - 3}
          </span>
        )
      }
    </div>
  </div>
</div>
